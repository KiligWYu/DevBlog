<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Kilig çš„åšå®¢ | ä»£ç ä¹‹å¤–"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>Combine å¤‡å¿˜æ¸…å• | ğ•¶ğ–ğ–‘ğ–ğ–Œ'ğ–˜ ğ•­ğ–‘ğ–”ğ–Œ</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script src="https://www.googletagmanager.com/gtag/js?id=G-YLMXL0J5N0" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-YLMXL0J5N0');
</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 7.1.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Combine å¤‡å¿˜æ¸…å•</h1><a id="logo" href="/.">ğ•¶ğ–ğ–‘ğ–ğ–Œ'ğ–˜ ğ•­ğ–‘ğ–”ğ–Œ</a><p class="description">ä»£ç ä¹‹å¤–</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/categories/%E7%A2%8E%E5%91%A8%E6%8A%A5/"><i class="fa fa-envelope"> ç¢å‘¨æŠ¥</i></a><a href="/categories/Learn-in-Public/"><i class="fa fa-leanpub"> Learn in Public</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-4-4"><div class="content_container"><div class="post"><h1 class="post-title">Combine å¤‡å¿˜æ¸…å•</h1><div class="post-meta">2024-06-16</div><!-- if theme.disqus.enable == true// a.disqus-comment-count(data-disqus-identifier=page.path, href=url_for(page.path) + '#disqus_thread')--><div class="post-content"><ul>
<li><a href="#publishers-subscribers">Publishers &amp; Subscribers</a>
<ul>
<li><a href="#publisher">Publisher</a></li>
<li><a href="#subscriber">Subscriber</a></li>
<li><a href="#cancellable">Cancellable</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A2%E9%98%85%E8%80%85">åˆ›å»ºè‡ªå®šä¹‰è®¢é˜…è€…</a></li>
<li><a href="#future">Future</a></li>
<li><a href="#%E7%B1%BB%E5%9E%8B%E6%93%A6%E9%99%A4type-erasure">ç±»å‹æ“¦é™¤ï¼ˆType erasureï¼‰</a></li>
</ul>
</li>
<li><a href="#operators">Operators</a>
<ul>
<li><a href="#transforming-operators">Transforming Operators</a>
<ul>
<li><a href="#collect">collect()</a></li>
<li><a href="#map_">map(_:)</a>
<ul>
<li><a href="#mapping-key-paths">Mapping key paths</a></li>
<li><a href="#trymap_">tryMap(_:)</a></li>
</ul>
</li>
<li><a href="#flatmapmaxpublishers_">flatMap(maxPublishers:_:)</a></li>
<li><a href="#replacenilwith">replaceNil(with:)</a></li>
<li><a href="#replaceemptywith">replaceEmpty(with:)</a></li>
<li><a href="#scan__">scan(_:_:)</a></li>
</ul>
</li>
<li><a href="#filtering-operators">Filtering Operators</a>
<ul>
<li><a href="#filtering">Filtering</a>
<ul>
<li><a href="#filter">filter</a></li>
<li><a href="#removeduplicates">removeDuplicates</a></li>
</ul>
</li>
<li><a href="#compacting-and-ignoring">Compacting and ignoring</a>
<ul>
<li><a href="#compactmap">compactMap</a></li>
<li><a href="#ignoreoutput">ignoreOutput</a></li>
</ul>
</li>
<li><a href="#finding-values">Finding values</a>
<ul>
<li><a href="#firstwhere">firstWhere</a></li>
<li><a href="#lastwhere">lastWhere</a></li>
</ul>
</li>
<li><a href="#dropping-values">Dropping values</a>
<ul>
<li><a href="#dropfirst">dropFirst</a></li>
<li><a href="#dropwhile">dropWhile</a></li>
<li><a href="#dropuntiloutputfrom">dropUntilOutputFrom</a></li>
</ul>
</li>
<li><a href="#limiting-values">Limiting values</a>
<ul>
<li><a href="#prefix">prefix</a></li>
<li><a href="#prefixwhile">prefixWhile</a></li>
<li><a href="#prefixuntiloutputfrom">prefixUntilOutputFrom</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#combining-operators">Combining Operators</a>
<ul>
<li><a href="#prepending">Prepending</a>
<ul>
<li><a href="#prependoutput">prepend(Outputâ€¦)</a></li>
<li><a href="#prependsequence">prepend(Sequence)</a></li>
<li><a href="#prependpublisher">prepend(Publisher)</a></li>
</ul>
</li>
<li><a href="#appending">Appending</a>
<ul>
<li><a href="#appendoutput">append(Outputâ€¦)</a></li>
<li><a href="#appendsequence">append(Sequence)</a></li>
<li><a href="#appendpublisher">append(Publisher)</a></li>
</ul>
</li>
<li><a href="#advanced-combining">Advanced combining</a>
<ul>
<li><a href="#switchtolatest">switchToLatest</a></li>
<li><a href="#mergewith">merge(with:)</a></li>
<li><a href="#combinelatest">combineLatest</a></li>
<li><a href="#zip">zip</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#time-manipulation-operators">Time Manipulation Operators</a>
<ul>
<li><a href="#shifting-time">Shifting time</a></li>
<li><a href="#collecting-values">Collecting values</a></li>
<li><a href="#holding-off-on-events">Holding off on events</a>
<ul>
<li><a href="#debounce">Debounce</a></li>
<li><a href="#throttle">Throttle</a></li>
<li><a href="#timing-out">Timing out</a></li>
</ul>
</li>
<li><a href="#measuring-time">Measuring time</a></li>
</ul>
</li>
<li><a href="#sequence-operators">Sequence Operators</a>
<ul>
<li><a href="#finding-values">Finding values</a>
<ul>
<li><a href="#min">min</a></li>
<li><a href="#max">max</a></li>
<li><a href="#first">first</a></li>
<li><a href="#last">last</a></li>
<li><a href="#outputat">output(at:)</a></li>
<li><a href="#outputin">output(in:)</a></li>
</ul>
</li>
<li><a href="#querying-the-publisher">Querying the publisher</a>
<ul>
<li><a href="#count">count</a></li>
<li><a href="#contains">contains</a></li>
<li><a href="#allsatisfy">allSatisfy</a></li>
<li><a href="#reduce">reduce</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#action">Action</a>
<ul>
<li><a href="#debugging">Debugging</a>
<ul>
<li><a href="#printing-events">Printing events</a></li>
<li><a href="#acting-on-events-performing-side-effects">Acting on events â€” performing side effects</a></li>
<li><a href="#using-the-debugger-as-a-last-resort">Using the debugger as a last resort</a></li>
</ul>
</li>
<li><a href="#timers">Timers</a>
<ul>
<li><a href="#using-runloop">Using RunLoop</a></li>
<li><a href="#using-the-timer-class">Using the Timer class</a></li>
<li><a href="#using-dispatchqueue">Using DispatchQueue</a></li>
</ul>
</li>
<li><a href="#key-value-observing">Key-Value Observing</a>
<ul>
<li><a href="#publisherforoptions">publisher(for:options:)</a></li>
<li><a href="#observation-options">Observation options</a></li>
</ul>
</li>
<li><a href="#resource-management">Resource Management</a>
<ul>
<li><a href="#the-share-operator">The share() operator</a></li>
<li><a href="#the-multicast_-operator">The multicast(_:) operator</a></li>
<li><a href="#future">Future</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#error-handling">Error Handling</a>
<ul>
<li><a href="#never">Never</a></li>
<li><a href="#setfailuretype">setFailureType</a></li>
<li><a href="#assigntoon">assign(to:on:)</a></li>
<li><a href="#assignto">assign(to:)</a></li>
<li><a href="#assertnofailure">assertNoFailure</a></li>
<li><a href="#catching-and-retrying">Catching and retrying</a></li>
</ul>
</li>
<li><a href="#schedulers">Schedulers</a>
<ul>
<li><a href="#subscribeon-%E5%92%8C-receiveon">subscribe(on:) å’Œ receive(on:)</a></li>
<li><a href="#scheduler-implementations">Scheduler implementations</a></li>
<li><a href="#runloopmain-vs-dispatchqueuemain">RunLoop.main vs DispatchQueue.main</a></li>
</ul>
</li>
<li><a href="#%E5%8F%A6%E8%A7%81">å¦è§</a></li>
</ul>
<p>Combine æ˜¯ä¸€ä¸ªå£°æ˜å¼ã€å“åº”å¼æ¡†æ¶ï¼Œç”¨äºéšç€æ—¶é—´çš„æ¨ç§»å¤„ç†å¼‚æ­¥äº‹ä»¶ã€‚æ”¯æŒ iOS 13ã€macOS 10.15ã€watchOS 6 åŠä¹‹åçš„ç³»ç»Ÿã€‚è¿™é‡Œæ˜¯æˆ‘å­¦ä¹  Combine æ—¶çš„ç¬”è®°ï¼Œåªæ˜¯åˆ—å‡ºè¦ç‚¹ï¼Œæ²¡æœ‰è¯¦ç»†çš„è§£é‡Šï¼Œæƒå½“å¤‡å¿˜æ¸…å•ã€‚</p>
<blockquote>
<p>The Combine framework provides a declarative approach for how your app processes events. Rather than potentially implementing multiple delegate callbacks or completion handler closures, you can create a single processing chain for a given event source. Each part of the chain is a Combine operator that performs a distinct action on the elements received from the previous step.</p>
</blockquote>
<h2 id="publishers-subscribers"><a class="markdownIt-Anchor" href="#publishers-subscribers"></a> Publishers &amp; Subscribers</h2>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162153303.png" alt="Publishers &amp; Subscribers" /></p>
<h3 id="publisher"><a class="markdownIt-Anchor" href="#publisher"></a> Publisher</h3>
<p><code>Publisher</code> åè®®å£°æ˜ç±»å‹å¯ä»¥éšç€æ—¶é—´çš„æ¨ç§»ä¼ è¾“ä¸€ç³»åˆ—å€¼ã€‚</p>
<p>å‘å¸ƒè€…å¯ä»¥å‘å‡ºä¸¤ç§äº‹ä»¶ï¼Œå€¼å’Œå®Œæˆäº‹ä»¶ã€‚å®ƒå¯ä»¥å‘å‡ºé›¶ä¸ªæˆ–å¤šä¸ªå€¼ï¼Œä½†åªèƒ½å‘å‡ºä¸€ä¸ªå®Œæˆäº‹ä»¶ï¼Œè¯¥äº‹ä»¶å¯ä»¥æ˜¯æ­£å¸¸å®Œæˆäº‹ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯é”™è¯¯ã€‚ä¸€æ—¦å‘å¸ƒè€…å‘å‡ºå®Œæˆäº‹ä»¶ï¼Œå®ƒå°±å®Œæˆäº†å¹¶ä¸”ä¸èƒ½å†å‘å‡ºä»»ä½•äº‹ä»¶ã€‚</p>
<h3 id="subscriber"><a class="markdownIt-Anchor" href="#subscriber"></a> Subscriber</h3>
<p><code>Subscriber</code> åè®®å£°æ˜ç±»å‹å¯ä»¥ä»å‘å¸ƒè€…æ¥æ”¶è¾“å…¥ã€‚å¦‚æœæ²¡æœ‰è®¢é˜…è€…æ¥æ¥æ”¶è¾“å‡ºï¼Œåˆ™å‘å¸ƒè€…ä¸ä¼šå‘å‡ºä»»ä½•å€¼ã€‚</p>
<p>Combine æä¾›ä¸¤ä¸ªå†…ç½®è®¢é˜…è€…ï¼š</p>
<ul>
<li><code>sink(_:_:)</code>ï¼šå…è®¸ä½ ä½¿ç”¨é—­åŒ…æ¥å¤„ç†è¾“å‡ºå€¼</li>
<li><code>assign(to:on:)</code>ï¼šå°†ç»“æœè¾“å‡ºç»‘å®šåˆ°æ•°æ®æ¨¡å‹æˆ– UI æ§ä»¶ä¸Šçš„æŸäº›å±æ€§</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> just <span class="operator">=</span> <span class="type">Just</span>(<span class="string">&quot;Hello world!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">_</span> <span class="operator">=</span> just</span><br><span class="line">  .sink(</span><br><span class="line">    receiveCompletion: &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;Received completion&quot;</span>, <span class="variable">$0</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    receiveValue: &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;Received value&quot;</span>, <span class="variable">$0</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SomeObject</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> value: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">    <span class="keyword">didSet</span> &#123;</span><br><span class="line">      <span class="built_in">print</span>(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> object <span class="operator">=</span> <span class="type">SomeObject</span>()</span><br><span class="line"><span class="keyword">let</span> publisher <span class="operator">=</span> [<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot;world!&quot;</span>].publisher</span><br><span class="line"><span class="keyword">_</span> <span class="operator">=</span> publisher</span><br><span class="line">  .assign(to: \.value, on: object)</span><br></pre></td></tr></table></figure>
<h3 id="cancellable"><a class="markdownIt-Anchor" href="#cancellable"></a> Cancellable</h3>
<p><code>Subscription</code> åè®®ç»§æ‰¿è‡ª <code>Cancellable</code> åè®®ï¼Œå½“è®¢é˜…è€…å®Œæˆå…¶å·¥ä½œå¹¶ä¸”ä¸å†å¸Œæœ›ä»å‘å¸ƒè€…æ¥æ”¶å€¼æ—¶ï¼Œå¯ä»¥è°ƒç”¨ <code>cancel()</code> ä»¥å–æ¶ˆè®¢é˜…ã€‚<br />
å¦‚æœä½ æ²¡æœ‰åœ¨è®¢é˜…ä¸Šæ˜ç¡®è°ƒç”¨ <code>cancel()</code>ï¼Œå®ƒå°†æŒç»­åˆ°å‘å¸ƒè€…å®Œæˆï¼Œæˆ–ç›´åˆ°æ­£å¸¸å†…å­˜ç®¡ç†å¯¼è‡´å­˜å‚¨çš„è®¢é˜…éåˆå§‹åŒ–ã€‚åˆ°é‚£æ—¶ï¼Œå®ƒä¼šä¸ºä½ å–æ¶ˆè®¢é˜…ã€‚</p>
<h3 id="åˆ›å»ºè‡ªå®šä¹‰è®¢é˜…è€…"><a class="markdownIt-Anchor" href="#åˆ›å»ºè‡ªå®šä¹‰è®¢é˜…è€…"></a> åˆ›å»ºè‡ªå®šä¹‰è®¢é˜…è€…</h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> publisher <span class="operator">=</span> (<span class="number">1</span> <span class="operator">...</span> <span class="number">6</span>).publisher</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">IntSubscriber</span>: <span class="title class_">Subscriber</span> &#123;</span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">Input</span> <span class="operator">=</span> <span class="type">Int</span></span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">Failure</span> <span class="operator">=</span> <span class="type">Never</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">receive</span>(<span class="params">subscription</span>: <span class="type">Subscription</span>) &#123;</span><br><span class="line">    subscription.request(.max(<span class="number">3</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">receive</span>(<span class="keyword">_</span> <span class="params">input</span>: <span class="type">Int</span>) -&gt; <span class="type">Subscribers</span>.<span class="type">Demand</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Received value&quot;</span>, input)</span><br><span class="line">    <span class="keyword">return</span> .none</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">func</span> <span class="title function_">receive</span>(<span class="params">completion</span>: <span class="type">Subscribers</span>.<span class="type">Completion</span>&lt;<span class="type">Never</span>&gt;) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Received completion&quot;</span>, completion)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="future"><a class="markdownIt-Anchor" href="#future"></a> Future</h3>
<p>å°±åƒå¯ä»¥ä½¿ç”¨ <code>Just</code> åˆ›å»ºå‘è®¢é˜…è€…å‘å‡ºå•ä¸ªå€¼ç„¶åå®Œæˆçš„å‘å¸ƒè€…ä¸€æ ·ï¼Œ <code>Future</code> å¯ç”¨äºå¼‚æ­¥ç”Ÿæˆå•ä¸ªç»“æœç„¶åå®Œæˆã€‚</p>
<p><code> Future</code> æ˜¯è´ªå©ªçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦åˆ›å»ºå°±ä¼šæ‰§è¡Œã€‚å®ƒä¸éœ€è¦åƒæ™®é€šå‘å¸ƒè€…é‚£æ ·æ‡’æƒ°çš„è®¢é˜…è€…ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subscriptions <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">futureIncrement</span>(</span><br><span class="line">  <span class="params">integer</span>: <span class="type">Int</span>,</span><br><span class="line">  <span class="params">afterDelay</span> <span class="params">delay</span>: <span class="type">TimeInterval</span>) -&gt; <span class="type">Future</span>&lt;<span class="type">Int</span>, <span class="type">Never</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">Future</span>&lt;<span class="type">Int</span>, <span class="type">Never</span>&gt; &#123; promise <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Original&quot;</span>)</span><br><span class="line">    <span class="type">DispatchQueue</span>.global().asyncAfter(deadline: .now() <span class="operator">+</span> delay) &#123;</span><br><span class="line">      promise(.success(integer <span class="operator">+</span> <span class="number">1</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> future <span class="operator">=</span> futureIncrement(integer: <span class="number">1</span>, afterDelay: <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">future</span><br><span class="line">  .sink(receiveCompletion: &#123; <span class="built_in">print</span>(<span class="variable">$0</span>) &#125;,</span><br><span class="line">        receiveValue: &#123; <span class="built_in">print</span>(<span class="variable">$0</span>) &#125;)</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æŒ‡å®šçš„å»¶è¿Ÿä¹‹åï¼Œç¬¬äºŒä¸ªè®¢é˜…ä¼šæ”¶åˆ°ç›¸åŒçš„å€¼</span></span><br><span class="line"><span class="comment">// feature ä¸ä¼šé‡æ–°å±¥è¡Œè¯ºè¨€ï¼›ç›¸åï¼Œå®ƒå…±äº«æˆ–é‡æ”¾å…¶è¾“å‡º</span></span><br><span class="line">future</span><br><span class="line">  .sink(receiveCompletion: &#123; <span class="built_in">print</span>(<span class="string">&quot;Second&quot;</span>, <span class="variable">$0</span>) &#125;,</span><br><span class="line">        receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;Second&quot;</span>, <span class="variable">$0</span>) &#125;)</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ç±»å‹æ“¦é™¤type-erasure"><a class="markdownIt-Anchor" href="#ç±»å‹æ“¦é™¤type-erasure"></a> ç±»å‹æ“¦é™¤ï¼ˆType erasureï¼‰</h3>
<p>æœ‰æ—¶ï¼Œä½ å¸Œæœ›è®©è®¢é˜…è€…è®¢é˜…ä»¥æ¥æ”¶æ¥è‡ªå‘å¸ƒè€…çš„äº‹ä»¶ï¼Œä½†æ— æ³•è®¿é—®æœ‰å…³è¯¥å‘å¸ƒè€…çš„å…¶ä»–è¯¦ç»†ä¿¡æ¯ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨ç±»å‹æ“¦é™¤ <code>eraseToAnyPublisher</code>ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subscriptions <span class="operator">=</span> <span class="type">Set</span>&lt;<span class="type">AnyCancellable</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Int</span>, <span class="type">Never</span>&gt;()</span><br><span class="line">  </span><br><span class="line"><span class="keyword">let</span> publisher <span class="operator">=</span> subject.eraseToAnyPublisher()</span><br><span class="line">  </span><br><span class="line">publisher</span><br><span class="line">  .sink(receiveValue: &#123; <span class="built_in">print</span>(<span class="variable">$0</span>) &#125;)</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br><span class="line">  </span><br><span class="line">subject.send(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// error: Value of type &#x27;AnyPublisher&lt;Int, Never&gt;&#x27; has no member &#x27;send&#x27;</span></span><br><span class="line">publisher.send(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="operators"><a class="markdownIt-Anchor" href="#operators"></a> Operators</h2>
<h3 id="transforming-operators"><a class="markdownIt-Anchor" href="#transforming-operators"></a> Transforming Operators</h3>
<h4 id="collect"><a class="markdownIt-Anchor" href="#collect"></a> collect()</h4>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162153420.png" alt="collect()" /></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>].publisher</span><br><span class="line">  .collect()</span><br><span class="line">  <span class="comment">// .collect(2)</span></span><br><span class="line">  .sink(receiveCompletion: &#123; <span class="built_in">print</span>(<span class="variable">$0</span>) &#125;,</span><br><span class="line">        receiveValue: &#123; <span class="built_in">print</span>(<span class="variable">$0</span>) &#125;)</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br></pre></td></tr></table></figure>
<h4 id="map_"><a class="markdownIt-Anchor" href="#map_"></a> map(_:)</h4>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162154662.png" alt="map(_:)" /></p>
<h5 id="mapping-key-paths"><a class="markdownIt-Anchor" href="#mapping-key-paths"></a> Mapping key paths</h5>
<ul>
<li><code>map&lt;T&gt;(_:)</code></li>
<li><code>map&lt;T0, T1&gt;(_:_:)</code></li>
<li><code>map&lt;T0, T1, T2&gt;(_:_:_:)</code></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">publisher</span><br><span class="line">  .map(\.x, \.y)</span><br><span class="line">  .sink(receiveValue: &#123; x, y <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">      <span class="string">&quot;The coordinate at (<span class="subst">\(x)</span>, <span class="subst">\(y)</span>) is in quadrant&quot;</span>,</span><br><span class="line">      quadrantOf(x: x, y: y)</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br><span class="line"></span><br><span class="line">publisher.send(<span class="type">Coordinate</span>(x: <span class="number">10</span>, y: <span class="operator">-</span><span class="number">8</span>))</span><br><span class="line">publisher.send(<span class="type">Coordinate</span>(x: <span class="number">0</span>, y: <span class="number">5</span>))</span><br></pre></td></tr></table></figure>
<h5 id="trymap_"><a class="markdownIt-Anchor" href="#trymap_"></a> tryMap(_:)</h5>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Just</span>(<span class="string">&quot;Directory name that does not exist&quot;</span>)</span><br><span class="line">  .tryMap &#123; <span class="keyword">try</span> <span class="type">FileManager</span>.default.contentsOfDirectory(atPath: <span class="variable">$0</span>) &#125;</span><br><span class="line">  .sink(receiveCompletion: &#123; <span class="built_in">print</span>(<span class="variable">$0</span>) &#125;,</span><br><span class="line">        receiveValue: &#123; <span class="built_in">print</span>(<span class="variable">$0</span>) &#125;)</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br></pre></td></tr></table></figure>
<h4 id="flatmapmaxpublishers_"><a class="markdownIt-Anchor" href="#flatmapmaxpublishers_"></a> flatMap(maxPublishers:_:)</h4>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162155701.png" alt="flatMap(maxPublishers:_:)" /></p>
<p><code>flatMap</code> æ¥æ”¶ä¸‰ä¸ªå‘å¸ƒè€…ï¼š <code>P1</code> ã€ <code>P2</code> å’Œ <code>P3</code> ã€‚ <code>flatMap</code> ä» <code>P1</code> å’Œ <code>P2</code> å‘å‡ºå‘å¸ƒè€…çš„å€¼ï¼Œä½†å¿½ç•¥ <code>P3</code> å› ä¸º <code>maxPublishers</code> è®¾ç½®ä¸º 2 ã€‚</p>
<h4 id="replacenilwith"><a class="markdownIt-Anchor" href="#replacenilwith"></a> replaceNil(with:)</h4>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162156246.png" alt="replaceNil(with:)" /></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;A&quot;</span>, <span class="literal">nil</span>, <span class="string">&quot;C&quot;</span>].publisher</span><br><span class="line">  .eraseToAnyPublisher()</span><br><span class="line">  .replaceNil(with: <span class="string">&quot;-&quot;</span>)</span><br><span class="line">  .sink(receiveValue: &#123; <span class="built_in">print</span>(<span class="variable">$0</span>) &#125;)</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br></pre></td></tr></table></figure>
<h4 id="replaceemptywith"><a class="markdownIt-Anchor" href="#replaceemptywith"></a> replaceEmpty(with:)</h4>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162156738.png" alt="replaceEmpty(with:)" /></p>
<h4 id="scan__"><a class="markdownIt-Anchor" href="#scan__"></a> scan(_:_:)</h4>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162156933.png" alt="scan" /></p>
<h3 id="filtering-operators"><a class="markdownIt-Anchor" href="#filtering-operators"></a> Filtering Operators</h3>
<h4 id="filtering"><a class="markdownIt-Anchor" href="#filtering"></a> Filtering</h4>
<h5 id="filter"><a class="markdownIt-Anchor" href="#filter"></a> filter</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162157534.png" alt="filter" /></p>
<h5 id="removeduplicates"><a class="markdownIt-Anchor" href="#removeduplicates"></a> removeDuplicates</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162157326.png" alt="removeDuplicates" /></p>
<h4 id="compacting-and-ignoring"><a class="markdownIt-Anchor" href="#compacting-and-ignoring"></a> Compacting and ignoring</h4>
<h5 id="compactmap"><a class="markdownIt-Anchor" href="#compactmap"></a> compactMap</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162157275.png" alt="compactMap" /></p>
<h5 id="ignoreoutput"><a class="markdownIt-Anchor" href="#ignoreoutput"></a> ignoreOutput</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162158611.png" alt="ignoreOutput" /></p>
<h4 id="finding-values"><a class="markdownIt-Anchor" href="#finding-values"></a> Finding values</h4>
<h5 id="firstwhere"><a class="markdownIt-Anchor" href="#firstwhere"></a> firstWhere</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162158592.png" alt="firstWhere" /></p>
<h5 id="lastwhere"><a class="markdownIt-Anchor" href="#lastwhere"></a> lastWhere</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162158996.png" alt="lastWhere" /></p>
<h4 id="dropping-values"><a class="markdownIt-Anchor" href="#dropping-values"></a> Dropping values</h4>
<h5 id="dropfirst"><a class="markdownIt-Anchor" href="#dropfirst"></a> dropFirst</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162158483.png" alt="dropFirst" /></p>
<h5 id="dropwhile"><a class="markdownIt-Anchor" href="#dropwhile"></a> dropWhile</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162158242.png" alt="dropWhile" /></p>
<h5 id="dropuntiloutputfrom"><a class="markdownIt-Anchor" href="#dropuntiloutputfrom"></a> dropUntilOutputFrom</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162159634.png" alt="dropUntilOutputFrom" /></p>
<h4 id="limiting-values"><a class="markdownIt-Anchor" href="#limiting-values"></a> Limiting values</h4>
<h5 id="prefix"><a class="markdownIt-Anchor" href="#prefix"></a> prefix</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162159971.png" alt="prefix" /></p>
<h5 id="prefixwhile"><a class="markdownIt-Anchor" href="#prefixwhile"></a> prefixWhile</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162159211.png" alt="prefixWhile" /></p>
<h5 id="prefixuntiloutputfrom"><a class="markdownIt-Anchor" href="#prefixuntiloutputfrom"></a> prefixUntilOutputFrom</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162159149.png" alt="prefixUntilOutputFrom" /></p>
<h3 id="combining-operators"><a class="markdownIt-Anchor" href="#combining-operators"></a> Combining Operators</h3>
<h4 id="prepending"><a class="markdownIt-Anchor" href="#prepending"></a> Prepending</h4>
<h5 id="prependoutput"><a class="markdownIt-Anchor" href="#prependoutput"></a> prepend(Outputâ€¦)</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162159017.png" alt="prepend(Outputâ€¦)" /></p>
<p>The last prepend affects the upstream first. The same below.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">.prepend(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">.prepend(<span class="operator">-</span><span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// output: -1 0 1 2</span></span><br></pre></td></tr></table></figure>
<h5 id="prependsequence"><a class="markdownIt-Anchor" href="#prependsequence"></a> prepend(Sequence)</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162200197.png" alt="prepend(Sequence)" /></p>
<h5 id="prependpublisher"><a class="markdownIt-Anchor" href="#prependpublisher"></a> prepend(Publisher)</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162200927.png" alt="prepend(Publisher)" /></p>
<h4 id="appending"><a class="markdownIt-Anchor" href="#appending"></a> Appending</h4>
<h5 id="appendoutput"><a class="markdownIt-Anchor" href="#appendoutput"></a> append(Outputâ€¦)</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162200181.png" alt="append(Outputâ€¦)" /></p>
<h5 id="appendsequence"><a class="markdownIt-Anchor" href="#appendsequence"></a> append(Sequence)</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162200285.png" alt="append(Sequence)" /></p>
<h5 id="appendpublisher"><a class="markdownIt-Anchor" href="#appendpublisher"></a> append(Publisher)</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162203782.png" alt="append(Publisher)" /></p>
<h4 id="advanced-combining"><a class="markdownIt-Anchor" href="#advanced-combining"></a> Advanced combining</h4>
<h5 id="switchtolatest"><a class="markdownIt-Anchor" href="#switchtolatest"></a> switchToLatest</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162203240.png" alt="switchToLatest" /></p>
<h5 id="mergewith"><a class="markdownIt-Anchor" href="#mergewith"></a> merge(with:)</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162204130.png" alt="merge(with:)" /></p>
<h5 id="combinelatest"><a class="markdownIt-Anchor" href="#combinelatest"></a> combineLatest</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162204136.png" alt="combineLatestPublisher" /></p>
<h5 id="zip"><a class="markdownIt-Anchor" href="#zip"></a> zip</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162204021.png" alt="zip" /></p>
<h3 id="time-manipulation-operators"><a class="markdownIt-Anchor" href="#time-manipulation-operators"></a> Time Manipulation Operators</h3>
<h4 id="shifting-time"><a class="markdownIt-Anchor" href="#shifting-time"></a> Shifting time</h4>
<p><code>delay(for:tolerance:scheduler:options)</code> è¿ç®—ç¬¦å¯¹æ•´ä¸ªå€¼åºåˆ—è¿›è¡Œæ—¶é—´åç§»ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162204606.png" alt="1.5s delay" /></p>
<h4 id="collecting-values"><a class="markdownIt-Anchor" href="#collecting-values"></a> Collecting values</h4>
<p><code>collect(_ strategy:options:)</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> collectMaxCount <span class="operator">=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> collectTimeStride <span class="operator">=</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sourcePublisher <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Date</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> collectedPublisher <span class="operator">=</span> sourcePublisher</span><br><span class="line">  <span class="comment">// æŒ‰æŒ‡å®šçš„æ—¶é—´é—´éš”ä»å‘å¸ƒè€…æ”¶é›†å€¼</span></span><br><span class="line">  .collect(.byTime(<span class="type">DispatchQueue</span>.main, .seconds(collectTimeStride)))</span><br><span class="line">  .flatMap &#123; dates <span class="keyword">in</span> dates.publisher &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> collectedPublisher2 <span class="operator">=</span> sourcePublisher</span><br><span class="line">  <span class="comment">// æŒ‰æŒ‡å®šçš„æ—¶é—´é—´éš”ä»å‘å¸ƒè€…æ”¶é›†å€¼å¹¶é™åˆ¶æ”¶é›†çš„å€¼çš„æ•°é‡</span></span><br><span class="line">  .collect(.byTimeOrCount(<span class="type">DispatchQueue</span>.main,</span><br><span class="line">                          .seconds(collectTimeStride),</span><br><span class="line">                          collectMaxCount))</span><br><span class="line">  .flatMap &#123; dates <span class="keyword">in</span> dates.publisher &#125;</span><br></pre></td></tr></table></figure>
<h4 id="holding-off-on-events"><a class="markdownIt-Anchor" href="#holding-off-on-events"></a> Holding off on events</h4>
<h5 id="debounce"><a class="markdownIt-Anchor" href="#debounce"></a> Debounce</h5>
<p><code>.debounce(for:scheduler:options:)</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> debounced <span class="operator">=</span> subject</span><br><span class="line">  <span class="comment">// æ¯ç§’æœ€å¤šå…è®¸å‘é€ä¸€ä¸ªå€¼ï¼Œå‘é€è¯¥ä¸€ç§’é—´éš”å†…å‘é€çš„æœ€åä¸€ä¸ªå€¼ï¼ˆå¦‚æœæœ‰ï¼‰</span></span><br><span class="line">  .debounce(for: .seconds(<span class="number">1.0</span>), scheduler: <span class="type">DispatchQueue</span>.main)</span><br><span class="line">  .share()</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Note:</strong> One thing to watch out for is the publisherâ€™s completion. If your publisher completes right after the last value was emitted, but before the time configured for <code>debounce</code> elapses, you will never see the last value in the debounced publisher!</p>
</blockquote>
<h5 id="throttle"><a class="markdownIt-Anchor" href="#throttle"></a> Throttle</h5>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> throttleDelay <span class="operator">=</span> <span class="number">1.0</span></span><br><span class="line"><span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> throttled <span class="operator">=</span> subject</span><br><span class="line">  .throttle(for: .seconds(throttleDelay), scheduler: <span class="type">DispatchQueue</span>.main, latest: <span class="literal">false</span>)</span><br><span class="line">  .share()</span><br></pre></td></tr></table></figure>
<p>å’Œ <code>debounce</code> çš„åŒºåˆ«æ˜¯ï¼š</p>
<ul>
<li><code>debounce</code> ç­‰å¾…æ¥æ”¶åˆ°çš„å€¼æš‚åœï¼Œç„¶ååœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”åå‘å‡ºæœ€æ–°çš„å€¼ã€‚</li>
<li><code>throttle</code> ç­‰å¾…æŒ‡å®šçš„æ—¶é—´é—´éš”ï¼Œç„¶åå‘å‡ºåœ¨è¯¥æ—¶é—´é—´éš”å†…æ”¶åˆ°çš„ç¬¬ä¸€ä¸ªæˆ–æœ€æ–°çš„å€¼ã€‚å®ƒä¸å…³å¿ƒæš‚åœã€‚</li>
</ul>
<h5 id="timing-out"><a class="markdownIt-Anchor" href="#timing-out"></a> Timing out</h5>
<p><code>timeout(_:scheduler:options:customError:)</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Void</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> timedOutSubject <span class="operator">=</span> subject.timeout(.seconds(<span class="number">5</span>), scheduler: <span class="type">DispatchQueue</span>.main)</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">TimeoutError</span>: <span class="title class_">Error</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> timedOut</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Void</span>, <span class="type">TimeoutError</span>&gt;()</span><br><span class="line"><span class="keyword">let</span> timedOutSubject <span class="operator">=</span> subject.timeout(.seconds(<span class="number">5</span>),</span><br><span class="line">                                      scheduler: <span class="type">DispatchQueue</span>.main,</span><br><span class="line">                                      customError: &#123; .timedOut &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="measuring-time"><a class="markdownIt-Anchor" href="#measuring-time"></a> Measuring time</h4>
<p><code>measureInterval(using:)</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">String</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="comment">// åœ¨ `DispatchQueue` çš„æƒ…å†µä¸‹ï¼Œ `TimeInterval` è¢«å®šä¹‰ä¸ºâ€œä½¿ç”¨è¯¥ç±»å‹çš„å€¼ï¼ˆä»¥çº³ç§’ä¸ºå•ä½ï¼‰åˆ›å»ºçš„ `DispatchTimeInterval` â€</span></span><br><span class="line"><span class="keyword">let</span> measureSubject <span class="operator">=</span> subject.measureInterval(using: <span class="type">DispatchQueue</span>.main)</span><br><span class="line"><span class="comment">// åœ¨ `RunLoop` è°ƒåº¦ç¨‹åºçš„è¾“å‡ºï¼Œå…¶å¤§å°ç›´æ¥ä»¥ç§’è¡¨ç¤º</span></span><br><span class="line"><span class="keyword">let</span> measureSubject2 <span class="operator">=</span> subject.measureInterval(using: <span class="type">RunLoop</span>.main)</span><br></pre></td></tr></table></figure>
<h3 id="sequence-operators"><a class="markdownIt-Anchor" href="#sequence-operators"></a> Sequence Operators</h3>
<h4 id="finding-values-2"><a class="markdownIt-Anchor" href="#finding-values-2"></a> Finding values</h4>
<h5 id="min"><a class="markdownIt-Anchor" href="#min"></a> min</h5>
<p><code>min</code> è¿ç®—ç¬¦å¯è®©ä½ æ‰¾åˆ°å‘å¸ƒè€…å‘å‡ºçš„æœ€å°å€¼ã€‚å®ƒæ˜¯è´ªå©ªçš„ï¼Œè¿™æ„å‘³ç€å®ƒå¿…é¡»ç­‰å¾…å‘å¸ƒè€…å‘é€ <code>.finished</code> å®Œæˆäº‹ä»¶ã€‚å‘å¸ƒè€…å®Œæˆåï¼Œè¿ç®—ç¬¦ä»…å‘å‡ºæœ€å°å€¼ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162204243.png" alt="min" /></p>
<h5 id="max"><a class="markdownIt-Anchor" href="#max"></a> max</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162205987.png" alt="max" /></p>
<h5 id="first"><a class="markdownIt-Anchor" href="#first"></a> first</h5>
<p>ä¸ä¼šç­‰å¾…ä¸Šæ¸¸å‘å¸ƒè€…å®Œæˆï¼Œè€Œæ˜¯åœ¨æ”¶åˆ°ç¬¬ä¸€ä¸ªå‘å‡ºçš„å€¼æ—¶å–æ¶ˆè®¢é˜…ã€‚<br />
è¿˜å¯ä»¥ä½¿ç”¨ <code>first(where:)</code>ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162205218.png" alt="first" /></p>
<h5 id="last"><a class="markdownIt-Anchor" href="#last"></a> last</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162205815.png" alt="last" /></p>
<h5 id="outputat"><a class="markdownIt-Anchor" href="#outputat"></a> output(at:)</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162205008.png" alt="output(at:)" /></p>
<h5 id="outputin"><a class="markdownIt-Anchor" href="#outputin"></a> output(in:)</h5>
<p>è¯¥è¿ç®—ç¬¦å‘å‡ºç´¢å¼•èŒƒå›´å†…çš„å„ä¸ªå€¼ï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„é›†åˆã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162206858.png" alt="output(in:)" /></p>
<h4 id="querying-the-publisher"><a class="markdownIt-Anchor" href="#querying-the-publisher"></a> Querying the publisher</h4>
<h5 id="count"><a class="markdownIt-Anchor" href="#count"></a> count</h5>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162206769.png" alt="count" /></p>
<h5 id="contains"><a class="markdownIt-Anchor" href="#contains"></a> contains</h5>
<p>å¦‚æœä¸Šæ¸¸å‘å¸ƒè€…å‘å‡ºæŒ‡å®šçš„å€¼ï¼Œåˆ™ <code>contains</code> è¿ç®—ç¬¦å°†å‘å‡º <code>true</code> å¹¶å–æ¶ˆè®¢é˜…ã€‚<br />
è¿˜å¯ä»¥ä½¿ç”¨ <code>contains(where:)</code>ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162206766.png" alt="contains" /></p>
<h5 id="allsatisfy"><a class="markdownIt-Anchor" href="#allsatisfy"></a> allSatisfy</h5>
<p>ä¸€æ—¦ä¸æ»¡è¶³æ¡ä»¶ï¼Œ<code>allSatisfy</code> å‘å‡º <code>false</code> å°±ç«‹å³å–æ¶ˆè®¢é˜…ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162206780.png" alt="allSatisfy" /></p>
<h5 id="reduce"><a class="markdownIt-Anchor" href="#reduce"></a> reduce</h5>
<p><code>scan</code> å’Œ <code>reduce</code> å…·æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Œä¸»è¦åŒºåˆ«åœ¨äº <code>scan</code> ä¸ºæ¯ä¸ªå‘å‡ºçš„å€¼å‘å‡ºç´¯ç§¯å€¼ï¼Œè€Œ <code>reduce</code> ä¸€æ—¦ä¸Šæ¸¸å‘å¸ƒè€…å‘é€ <code>.finished</code> å®Œæˆäº‹ä»¶ï¼Œå°±ä¼šå‘å‡ºå•ä¸ªç´¯ç§¯å€¼ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162206410.png" alt="reduce" /></p>
<h2 id="action"><a class="markdownIt-Anchor" href="#action"></a> Action</h2>
<h3 id="debugging"><a class="markdownIt-Anchor" href="#debugging"></a> Debugging</h3>
<h4 id="printing-events"><a class="markdownIt-Anchor" href="#printing-events"></a> Printing events</h4>
<p><code>print(:to:)</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subscription <span class="operator">=</span> (<span class="number">1</span><span class="operator">...</span><span class="number">3</span>).publisher</span><br><span class="line">  .print(<span class="string">&quot;publisher&quot;</span>)</span><br><span class="line">  .sink &#123; <span class="keyword">_</span> <span class="keyword">in</span> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="acting-on-events-performing-side-effects"><a class="markdownIt-Anchor" href="#acting-on-events-performing-side-effects"></a> Acting on events â€” performing side effects</h4>
<p>é™¤äº†æ‰“å°ä¿¡æ¯ä¹‹å¤–ï¼Œå¯¹ç‰¹å®šäº‹ä»¶æ‰§è¡Œæ“ä½œé€šå¸¸ä¹Ÿå¾ˆæœ‰ç”¨ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸º<strong>æ‰§è¡Œå‰¯ä½œç”¨</strong>ï¼Œå› ä¸ºæ‚¨â€œåœ¨ä¾§é¢â€é‡‡å–çš„æ“ä½œä¸ä¼šç›´æ¥å½±å“ä¸‹æ¸¸çš„å…¶ä»–å‘å¸ƒè€…ï¼Œä½†å¯èƒ½ä¼šäº§ç”Ÿç±»ä¼¼äºä¿®æ”¹å¤–éƒ¨å˜é‡çš„æ•ˆæœã€‚</p>
<p><code>handleEvents(receiveSubscription:receiveOutput:receiveCompletion:receiveCancel:receiveRequest:)</code></p>
<h4 id="using-the-debugger-as-a-last-resort"><a class="markdownIt-Anchor" href="#using-the-debugger-as-a-last-resort"></a> Using the debugger as a last resort</h4>
<p><code>breakpointOnError()</code><br />
<code>breakpoint(receiveSubscription:receiveOutput:receiveCompletion:)</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.breakpoint(receiveOutput: &#123; value <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">return</span> value <span class="operator">&gt;</span> <span class="number">10</span> <span class="operator">&amp;&amp;</span> value <span class="operator">&lt;</span> <span class="number">15</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="timers"><a class="markdownIt-Anchor" href="#timers"></a> Timers</h3>
<h4 id="using-runloop"><a class="markdownIt-Anchor" href="#using-runloop"></a> Using RunLoop</h4>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> runLoop <span class="operator">=</span> <span class="type">RunLoop</span>.main</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subscription <span class="operator">=</span> runLoop.schedule(</span><br><span class="line">  after: runLoop.now,</span><br><span class="line">  interval: .seconds(<span class="number">1</span>),</span><br><span class="line">  tolerance: .milliseconds(<span class="number">100</span>)</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Timer fired&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">runLoop.schedule(after: .<span class="keyword">init</span>(<span class="type">Date</span>(timeIntervalSinceNow: <span class="number">3.0</span>))) &#123;</span><br><span class="line">  subscription.cancel()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="using-the-timer-class"><a class="markdownIt-Anchor" href="#using-the-timer-class"></a> Using the Timer class</h4>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subscription <span class="operator">=</span> <span class="type">Timer</span></span><br><span class="line">  .publish(every: <span class="number">1.0</span>, on: .main, in: .common)</span><br><span class="line">  .autoconnect()</span><br><span class="line">  .scan(<span class="number">0</span>) &#123; counter, <span class="keyword">_</span> <span class="keyword">in</span> counter <span class="operator">+</span> <span class="number">1</span> &#125;</span><br><span class="line">  .sink &#123; counter <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Counter is <span class="subst">\(counter)</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="using-dispatchqueue"><a class="markdownIt-Anchor" href="#using-dispatchqueue"></a> Using DispatchQueue</h4>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> queue <span class="operator">=</span> <span class="type">DispatchQueue</span>.main</span><br><span class="line"><span class="keyword">let</span> source <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Int</span>, <span class="type">Never</span>&gt;()</span><br><span class="line"><span class="keyword">var</span> counter <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cancellable <span class="operator">=</span> queue.schedule(</span><br><span class="line">  after: queue.now,</span><br><span class="line">  interval: .seconds(<span class="number">1</span>)</span><br><span class="line">) &#123;</span><br><span class="line">  source.send(counter)</span><br><span class="line">  counter <span class="operator">+=</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subscription <span class="operator">=</span> source.sink &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Timer emitted <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="key-value-observing"><a class="markdownIt-Anchor" href="#key-value-observing"></a> Key-Value Observing</h3>
<h4 id="publisherforoptions"><a class="markdownIt-Anchor" href="#publisherforoptions"></a> publisher(for:options:)</h4>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> queue <span class="operator">=</span> <span class="type">OperationQueue</span>()</span><br><span class="line"><span class="keyword">let</span> subscription <span class="operator">=</span> queue.publisher(for: \.operationCount)</span><br><span class="line">  .sink &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Outstanding operations in queue: <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestObject</span>: <span class="title class_">NSObject</span> &#123;</span><br><span class="line">  <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> integerProperty: <span class="type">Int</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> stringProperty: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="keyword">@objc</span> <span class="keyword">dynamic</span> <span class="keyword">var</span> arrayProperty: [<span class="type">Float</span>] <span class="operator">=</span> []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj <span class="operator">=</span> <span class="type">TestObject</span>()</span><br><span class="line"><span class="keyword">let</span> subscription <span class="operator">=</span> obj.publisher(for: \.integerProperty)</span><br><span class="line">  .sink &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;integerProperty changes to <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">let</span> subscription2 <span class="operator">=</span> obj.publisher(for: \.stringProperty)</span><br><span class="line">  .sink &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;stringProperty changes to <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">let</span> subscription3 <span class="operator">=</span> obj.publisher(for: \.arrayProperty)</span><br><span class="line">  .sink &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;arrayProperty changes to <span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">obj.integerProperty <span class="operator">=</span> <span class="number">100</span></span><br><span class="line">obj.integerProperty <span class="operator">=</span> <span class="number">200</span></span><br><span class="line">obj.stringProperty <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span></span><br><span class="line">obj.arrayProperty <span class="operator">=</span> [<span class="number">1.0</span>]</span><br><span class="line">obj.stringProperty <span class="operator">=</span> <span class="string">&quot;World&quot;</span></span><br><span class="line">obj.arrayProperty <span class="operator">=</span> [<span class="number">1.0</span>, <span class="number">2.0</span>]</span><br></pre></td></tr></table></figure>
<h4 id="observation-options"><a class="markdownIt-Anchor" href="#observation-options"></a> Observation options</h4>
<p><code>options</code> å‚æ•°æ˜¯ä¸€ä¸ªå…·æœ‰å››ä¸ªå€¼çš„é€‰é¡¹é›†ï¼š <code>.initial</code> ã€ <code>.prior</code> ã€ <code>.old</code> å’Œ <code>.new</code> ã€‚é»˜è®¤å€¼ä¸º <code>[.initial] </code>ã€‚</p>
<h3 id="resource-management"><a class="markdownIt-Anchor" href="#resource-management"></a> Resource Management</h3>
<h4 id="the-share-operator"><a class="markdownIt-Anchor" href="#the-share-operator"></a> The share() operator</h4>
<p><code>share()</code> è¿ç®—ç¬¦çš„ç›®çš„æ˜¯è®©ä½ é€šè¿‡å¼•ç”¨è€Œä¸æ˜¯é€šè¿‡å€¼è·å–å‘å¸ƒè€…ã€‚<br />
<code>share()</code> è¿ç®—ç¬¦è¿”å› <code>Publishers.Share</code> ç±»çš„å®ä¾‹ã€‚è¿™ä¸ªæ–°å‘å¸ƒè€…â€œå…±äº«â€ä¸Šæ¸¸å‘å¸ƒè€…ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä½ æ­£åœ¨æ‰§è¡Œä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œå¸Œæœ›å¤šä¸ªè®¢é˜…è€…æ¥æ”¶ç»“æœè€Œä¸éœ€è¦å¤šæ¬¡è¯·æ±‚ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> shared <span class="operator">=</span> <span class="type">URLSession</span>.shared</span><br><span class="line">  .dataTaskPublisher(for: <span class="type">URL</span>(string: <span class="string">&quot;https://www.kodeco.com&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">  .map(\.data)</span><br><span class="line">  .print(<span class="string">&quot;shared&quot;</span>)</span><br><span class="line">  .share()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;subscribing first&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subscription1 <span class="operator">=</span> shared.sink(</span><br><span class="line">  receiveCompletion: &#123; <span class="keyword">_</span> <span class="keyword">in</span> &#125;,</span><br><span class="line">  receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;subscription1 received: &#x27;<span class="subst">\(<span class="variable">$0</span>)</span>&#x27;&quot;</span>) &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;subscribing second&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subscription2 <span class="operator">=</span> shared.sink(</span><br><span class="line">  receiveCompletion: &#123; <span class="keyword">_</span> <span class="keyword">in</span> &#125;,</span><br><span class="line">  receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;subscription2 received: &#x27;<span class="subst">\(<span class="variable">$0</span>)</span>&#x27;&quot;</span>) &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="the-multicast_-operator"><a class="markdownIt-Anchor" href="#the-multicast_-operator"></a> The multicast(_:) operator</h4>
<p><code>multicast(_:)</code> çš„ç‹¬ç‰¹ç‰¹å¾æ˜¯å®ƒè¿”å›çš„å‘å¸ƒè€…æ˜¯ <code>ConnectablePublisher</code> ã€‚è¿™æ„å‘³ç€åœ¨è°ƒç”¨å…¶ <code>connect()</code> æ–¹æ³•ä¹‹å‰ï¼Œå®ƒä¸ä¼šè®¢é˜…ä¸Šæ¸¸å‘å¸ƒè€…ã€‚è¿™ä½¿ä½ æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥è®¾ç½®æ‰€éœ€çš„æ‰€æœ‰è®¢é˜…è€…ï¼Œç„¶åå†è®©å®ƒè¿æ¥åˆ°ä¸Šæ¸¸å‘å¸ƒè€…å¹¶å¼€å§‹å·¥ä½œã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> subject <span class="operator">=</span> <span class="type">PassthroughSubject</span>&lt;<span class="type">Data</span>, <span class="type">URLError</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> multicasted <span class="operator">=</span> <span class="type">URLSession</span>.shared</span><br><span class="line">  .dataTaskPublisher(for: <span class="type">URL</span>(string: <span class="string">&quot;https://www.raywenderlich.com&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">  .map(\.data)</span><br><span class="line">  .print(<span class="string">&quot;multicast&quot;</span>)</span><br><span class="line">  .multicast(subject: subject)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subscription1 <span class="operator">=</span> multicasted</span><br><span class="line">  .sink(</span><br><span class="line">    receiveCompletion: &#123; <span class="keyword">_</span> <span class="keyword">in</span> &#125;,</span><br><span class="line">    receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;subscription1 received: &#x27;<span class="subst">\(<span class="variable">$0</span>)</span>&#x27;&quot;</span>) &#125;</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subscription2 <span class="operator">=</span> multicasted</span><br><span class="line">  .sink(</span><br><span class="line">    receiveCompletion: &#123; <span class="keyword">_</span> <span class="keyword">in</span> &#125;,</span><br><span class="line">    receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;subscription2 received: &#x27;<span class="subst">\(<span class="variable">$0</span>)</span>&#x27;&quot;</span>) &#125;</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> cancellable <span class="operator">=</span> multicasted.connect()</span><br></pre></td></tr></table></figure>
<h4 id="future-2"><a class="markdownIt-Anchor" href="#future-2"></a> Future</h4>
<p><code>Future</code> æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç»“æ„ã€‚åˆ›å»ºåï¼Œç«‹å³æ‰§è¡Œï¼Œå­˜å‚¨å·²å®Œæˆçš„ <code>Promise</code> çš„ç»“æœå¹¶å°†å…¶ä¼ é€’ç»™å½“å‰å’Œæœªæ¥çš„è®¢é˜…è€…ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">performSomeWork</span>() <span class="keyword">throws</span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Performing some work and returning a result&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> future <span class="operator">=</span> <span class="type">Future</span>&lt;<span class="type">Int</span>, <span class="type">Error</span>&gt; &#123; fulfill <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> result <span class="operator">=</span> <span class="keyword">try</span> performSomeWork()</span><br><span class="line">    fulfill(.success(result))</span><br><span class="line">  &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">    fulfill(.failure(error))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Subscribing to future...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> subscription1 <span class="operator">=</span> future</span><br><span class="line">  .sink(</span><br><span class="line">    receiveCompletion: &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="built_in">print</span>(<span class="string">&quot;subscription1 completed&quot;</span>) &#125;,</span><br><span class="line">    receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;subscription1 received: &#x27;<span class="subst">\(<span class="variable">$0</span>)</span>&#x27;&quot;</span>) &#125;</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">let</span> subscription2 <span class="operator">=</span> future</span><br><span class="line">  .sink(</span><br><span class="line">    receiveCompletion: &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="built_in">print</span>(<span class="string">&quot;subscription2 completed&quot;</span>) &#125;,</span><br><span class="line">    receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;subscription2 received: &#x27;<span class="subst">\(<span class="variable">$0</span>)</span>&#x27;&quot;</span>) &#125;</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<h2 id="advanced-combine"><a class="markdownIt-Anchor" href="#advanced-combine"></a> Advanced Combine</h2>
<h3 id="error-handling"><a class="markdownIt-Anchor" href="#error-handling"></a> Error Handling</h3>
<h4 id="never"><a class="markdownIt-Anchor" href="#never"></a> Never</h4>
<p><code>Failure</code> ç±»å‹ä¸º <code>Never</code> çš„å‘å¸ƒè€…è¡¨æ˜è¯¥å‘å¸ƒè€…æ°¸è¿œä¸ä¼šå¤±è´¥ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162207260.png" alt="Never" /></p>
<p><code>Just</code> å§‹ç»ˆå£°æ˜ <code>Failure</code> ä¸º <code>Never</code> ã€‚</p>
<h4 id="setfailuretype"><a class="markdownIt-Anchor" href="#setfailuretype"></a> setFailureType</h4>
<p>å°†ç»å¯¹æ­£ç¡®çš„å‘å¸ƒè€…è½¬å˜ä¸ºä¼šå‘å‡ºé”™è¯¯çš„å‘å¸ƒè€…çš„ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ <code>setFailureType</code> ã€‚è¿™æ˜¯å¦ä¸€ä¸ªä»…é€‚ç”¨äºå¤±è´¥ç±»å‹ä¸º <code>Never</code> çš„å‘å¸ƒè€…çš„è¿ç®—ç¬¦ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">MyError</span>: <span class="title class_">Error</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> ohNo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Just</span>(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">  .setFailureType(to: <span class="type">MyError</span>.<span class="keyword">self</span>)</span><br><span class="line">  .sink(</span><br><span class="line">    receiveCompletion: &#123; completion <span class="keyword">in</span></span><br><span class="line">      <span class="keyword">switch</span> completion &#123;</span><br><span class="line">      <span class="keyword">case</span> .failure(.ohNo):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Finished with Oh No!&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> .finished:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Finished successfully!&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    receiveValue: &#123; value <span class="keyword">in</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;Got value: <span class="subst">\(value)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br></pre></td></tr></table></figure>
<h4 id="assigntoon"><a class="markdownIt-Anchor" href="#assigntoon"></a> assign(to:on:)</h4>
<p><code>assign</code> è¿ç®—ç¬¦ä»…é€‚ç”¨äºä¸ä¼šå¤±è´¥çš„å‘å¸ƒè€…ï¼Œä¸ <code>setFailureType</code> ç›¸åŒã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> id <span class="operator">=</span> <span class="type">UUID</span>()</span><br><span class="line">  <span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;Unknown&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person <span class="operator">=</span> <span class="type">Person</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;1&quot;</span>, person.name)</span><br><span class="line"></span><br><span class="line"><span class="type">Just</span>(<span class="string">&quot;Shai&quot;</span>)</span><br><span class="line">  .handleEvents(</span><br><span class="line">    receiveCompletion: &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="built_in">print</span>(<span class="string">&quot;2&quot;</span>, person.name) &#125;</span><br><span class="line">  )</span><br><span class="line">  .assign(to: \.name, on: person)</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br></pre></td></tr></table></figure>
<h4 id="assignto"><a class="markdownIt-Anchor" href="#assignto"></a> assign(to:)</h4>
<p><code>assign(to:on:)</code> ä¼šå¼ºå¼•ç”¨ <code>on</code> å‚æ•°çš„å¯¹è±¡ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyViewModel</span>: <span class="title class_">ObservableObject</span> &#123;</span><br><span class="line">  <span class="meta">@Published</span> <span class="keyword">var</span> currentDate <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">init</span>() &#123;</span><br><span class="line">    <span class="type">Timer</span>.publish(every: <span class="number">1</span>, on: .main, in: .common)</span><br><span class="line">      .autoconnect()</span><br><span class="line">      .prefix(<span class="number">3</span>)</span><br><span class="line">      .assign(to: <span class="operator">&amp;</span><span class="variable">$currentDate</span>)</span><br><span class="line">    <span class="comment">// ä¸‹é¢ä¸¤è¡Œä¼šé€ æˆå¾ªç¯å¼•ç”¨</span></span><br><span class="line">    <span class="comment">// .assign(to: \.currentDate, on: self)</span></span><br><span class="line">    <span class="comment">// .store(in: &amp;subscriptions)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vm <span class="operator">=</span> <span class="type">MyViewModel</span>()</span><br><span class="line">vm.<span class="variable">$currentDate</span></span><br><span class="line">  .sink(receiveValue: &#123; <span class="built_in">print</span>(<span class="variable">$0</span>) &#125;)</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br></pre></td></tr></table></figure>
<h4 id="assertnofailure"><a class="markdownIt-Anchor" href="#assertnofailure"></a> assertNoFailure</h4>
<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸ºç¡®è®¤å‘å¸ƒè€…æ— æ³•ä»¥å¤±è´¥äº‹ä»¶å®Œæˆæ—¶ï¼Œ<code>assertNoFailure</code> è¿ç®—ç¬¦éå¸¸æœ‰ç”¨ã€‚å®ƒä¸ä¼šé˜»æ­¢ä¸Šæ¸¸å‘å‡ºæ•…éšœäº‹ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ£€æµ‹åˆ°é”™è¯¯ï¼Œå®ƒä¼šå´©æºƒå¹¶æ˜¾ç¤º <code>fatalError</code>ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">MyError</span>: <span class="title class_">Error</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> ohNo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Just</span>(<span class="string">&quot;Hello&quot;</span>)</span><br><span class="line">  .setFailureType(to: <span class="type">MyError</span>.<span class="keyword">self</span>)</span><br><span class="line">  .tryMap &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="keyword">throw</span> <span class="type">MyError</span>.ohNo &#125;</span><br><span class="line">  .assertNoFailure()</span><br><span class="line">  .sink(receiveValue: &#123; <span class="built_in">print</span>(<span class="string">&quot;Got value: <span class="subst">\(<span class="variable">$0</span>)</span> &quot;</span>) &#125;)</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br></pre></td></tr></table></figure>
<h4 id="catching-and-retrying"><a class="markdownIt-Anchor" href="#catching-and-retrying"></a> Catching and retrying</h4>
<p><code>retry</code> è¿ç®—ç¬¦æ¥å—ä¸€ä¸ªæ•°å­—ã€‚å¦‚æœå‘å¸ƒè€…å¤±è´¥ï¼Œå®ƒå°†é‡æ–°è®¢é˜…ä¸Šæ¸¸å¹¶é‡è¯•æœ€å¤šæ‚¨æŒ‡å®šçš„æ¬¡æ•°ã€‚å¦‚æœæ‰€æœ‰é‡è¯•éƒ½å¤±è´¥ï¼Œå®ƒåªä¼šå°†é”™è¯¯æ¨é€åˆ°ä¸‹æ¸¸ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> photoService <span class="operator">=</span> <span class="type">PhotoService</span>()</span><br><span class="line"></span><br><span class="line">photoService</span><br><span class="line">  .fetchPhoto(quality: .high, failingTimes: <span class="number">2</span>)</span><br><span class="line">  .handleEvents(</span><br><span class="line">    receiveSubscription: &#123; <span class="keyword">_</span> <span class="keyword">in</span> <span class="built_in">print</span>(<span class="string">&quot;Trying ...&quot;</span>) &#125;,</span><br><span class="line">    receiveCompletion: &#123;</span><br><span class="line">      <span class="keyword">guard</span> <span class="keyword">case</span> .failure(<span class="keyword">let</span> error) <span class="operator">=</span> <span class="variable">$0</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;Got error: <span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line"><span class="operator">+</span> .retry(<span class="number">3</span>)</span><br><span class="line"><span class="operator">+</span> .catch &#123; <span class="keyword">_</span> -&gt; <span class="type">PhotoService</span>.<span class="type">Publisher</span> <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Failed fetching high quality, falling back to low quality&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> photoService.fetchPhoto(quality: .low)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="operator">+</span> .replaceError(with: <span class="type">UIImage</span>(named: <span class="string">&quot;na.jpg&quot;</span>)<span class="operator">!</span>)</span><br><span class="line">  .sink(</span><br><span class="line">    receiveCompletion: &#123; <span class="built_in">print</span>(<span class="string">&quot;<span class="subst">\(<span class="variable">$0</span>)</span>&quot;</span>) &#125;,</span><br><span class="line">    receiveValue: &#123; image <span class="keyword">in</span></span><br><span class="line">      image</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;Got image: <span class="subst">\(image)</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">  .store(in: <span class="operator">&amp;</span>subscriptions)</span><br></pre></td></tr></table></figure>
<h3 id="schedulers"><a class="markdownIt-Anchor" href="#schedulers"></a> Schedulers</h3>
<p>Combine æ¡†æ¶æä¾›äº†ä¸¤ä¸ªä¸è°ƒåº¦ç¨‹åºä¸€èµ·ä½¿ç”¨çš„åŸºæœ¬è¿ç®—ç¬¦ï¼š</p>
<ul>
<li><code>subscribe(on:)</code> å’Œ <code>subscribe(on:options:)</code> åœ¨æŒ‡å®šçš„è°ƒåº¦ç¨‹åºä¸Šåˆ›å»ºè®¢é˜…ï¼ˆå¼€å§‹å·¥ä½œï¼‰ã€‚</li>
<li><code>receive(on:)</code> å’Œ <code>receive(on:options:)</code> åœ¨æŒ‡å®šçš„è°ƒåº¦ç¨‹åºä¸Šä¼ é€’å€¼ã€‚</li>
</ul>
<p>æ­¤å¤–ï¼Œä»¥ä¸‹è¿ç®—ç¬¦å°†è°ƒåº¦ç¨‹åºå’Œè°ƒåº¦ç¨‹åºé€‰é¡¹ä½œä¸ºå‚æ•°ã€‚</p>
<ul>
<li><code>debounce(for:scheduler:options:)</code></li>
<li><code>delay(for:tolerance:scheduler:options:)</code></li>
<li><code>measureInterval(using:options:)</code></li>
<li><code>throttle(for:scheduler:latest:)</code></li>
<li><code>timeout(_:scheduler:options:customError:)</code></li>
</ul>
<h4 id="subscribeon-å’Œ-receiveon"><a class="markdownIt-Anchor" href="#subscribeon-å’Œ-receiveon"></a> subscribe(on:) å’Œ receive(on:)</h4>
<p><img src="https://cdn.jsdelivr.net/gh/KiligWYu/Pics/Combine/202406162208298.png" alt="subscribe(on:) å’Œ receive(on:)" /></p>
<ol>
<li><code>Publisher</code> æ¥æ”¶è®¢é˜…è€…å¹¶åˆ›å»ºä¸€ä¸ª <code>Subscription</code></li>
<li><code>Subscriber</code> æ¥æ”¶è®¢é˜…å¹¶è¯·æ±‚æ¥è‡ªå‘å¸ƒè€…çš„å€¼ï¼ˆè™šçº¿ï¼‰</li>
<li><code>Publisher</code> å¼€å§‹å·¥ä½œï¼ˆé€šè¿‡ <code>Subscription</code> ï¼‰</li>
<li><code>Publisher</code> å‘å‡ºå€¼ï¼ˆé€šè¿‡ <code>Subscription</code> ï¼‰</li>
<li>è¿ç®—ç¬¦è½¬æ¢å€¼</li>
<li><code>Subscriber</code> æ¥æ”¶æœ€ç»ˆå€¼</li>
</ol>
<p>æ­¥éª¤ä¸€ã€äºŒå’Œä¸‰é€šå¸¸å‘ç”Ÿåœ¨ä»£ç è®¢é˜…å‘å¸ƒè€…æ—¶å½“å‰çš„çº¿ç¨‹ä¸Šã€‚ä½†æ˜¯å½“æ‚¨ä½¿ç”¨ <code>subscribe(on:)</code> è¿ç®—ç¬¦æ—¶ï¼Œæ‰€æœ‰è¿™äº›æ“ä½œéƒ½åœ¨æ‚¨æŒ‡å®šçš„è°ƒåº¦ç¨‹åºä¸Šè¿è¡Œã€‚ä¾‹å¦‚ï¼Œå‘å¸ƒè€…åœ¨åå°æ‰§è¡Œä¸€äº›æ˜‚è´µçš„è®¡ç®—æ—¶ï¼Œä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œæ‰§è¡Œæ­¤æ“ä½œçš„ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ <code>subscribe(on:)</code>ã€‚</p>
<p><code>receive(on:)</code> å…è®¸ä½ æŒ‡å®šåº”ä½¿ç”¨å“ªä¸ªè°ƒåº¦ç¨‹åºæ¥å‘è®¢é˜…è€…ä¼ é€’å€¼ã€‚ä¾‹å¦‚åœ¨ä¸»çº¿ç¨‹æ¥æ”¶å€¼ä»¥æ›´æ–° UIã€‚</p>
<h4 id="scheduler-implementations"><a class="markdownIt-Anchor" href="#scheduler-implementations"></a> Scheduler implementations</h4>
<ul>
<li><code>ImmediateScheduler</code>ï¼šç«‹å³åœ¨å½“å‰çº¿ç¨‹ä¸Šæ‰§è¡Œä»£ç ï¼Œè¿™æ˜¯é»˜è®¤çš„æ‰§è¡Œä¸Šä¸‹æ–‡</li>
<li><code>RunLoop</code>ï¼šç»‘å®šåˆ° <code>Foundation</code> çš„ <code>Thread</code> å¯¹è±¡</li>
<li><code>DispatchQueue</code>ï¼šå¯ä»¥æ˜¯ä¸²è¡Œçš„ä¹Ÿå¯ä»¥æ˜¯å¹¶å‘çš„</li>
<li><code>OperationQueue</code>ï¼šè°ƒèŠ‚å·¥ä½œé¡¹æ‰§è¡Œçš„é˜Ÿåˆ—</li>
<li><code>TestScheduler</code>ï¼šä¸€ä¸ªè™šæ‹Ÿçš„ã€æ¨¡æ‹Ÿçš„è°ƒåº¦ç¨‹åºï¼Œç”¨äºæµ‹è¯•</li>
</ul>
<h5 id="runloopmain-vs-dispatchqueuemain"><a class="markdownIt-Anchor" href="#runloopmain-vs-dispatchqueuemain"></a> RunLoop.main vs DispatchQueue.main</h5>
<blockquote>
<p>RunLoop æ˜¯ç®¡ç†è¾“å…¥æºï¼ˆä¾‹å¦‚åº”ç”¨ç¨‹åºçš„è§¦æ‘¸ï¼‰çš„å¯¹è±¡çš„ç¼–ç¨‹æ¥å£ã€‚ RunLoop ç”±ç³»ç»Ÿåˆ›å»ºå’Œç®¡ç†ï¼Œç³»ç»Ÿè¿˜è´Ÿè´£ä¸ºæ¯ä¸ªçº¿ç¨‹å¯¹è±¡åˆ›å»ºä¸€ä¸ª RunLoop å¯¹è±¡ã€‚ç³»ç»Ÿè¿˜è´Ÿè´£åˆ›å»ºä»£è¡¨ä¸»çº¿ç¨‹çš„ä¸»è¿è¡Œå¾ªç¯ã€‚</p>
<p><code>DispatchQueue.main</code> æ˜¯ä¸å½“å‰è¿›ç¨‹çš„ä¸»çº¿ç¨‹å…³è”çš„è°ƒåº¦é˜Ÿåˆ—ã€‚ç³»ç»Ÿè´Ÿè´£ç”Ÿæˆä»£è¡¨ä¸»çº¿ç¨‹çš„é˜Ÿåˆ—ã€‚è°ƒåº¦é˜Ÿåˆ—åœ¨å…¶å…³è”çš„çº¿ç¨‹ä¸Šä¸²è¡Œæˆ–å¹¶å‘åœ°æ‰§è¡Œä»»åŠ¡ã€‚</p>
<p><code>RunLoop.main</code> å’Œ <code>DispatchQueue.main</code> éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œå…¶ä»£ç ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨ä¸¤è€…æ¥æ›´æ–°ç”¨æˆ·ç•Œé¢ã€‚</p>
<p><code>RunLoop.main</code> å’Œ <code>DispatchQueue.main</code> ä¹‹é—´æœ€æ˜¾ç€çš„åŒºåˆ«æ˜¯åè€…å³ä½¿åœ¨ RunLoop ç¹å¿™æ—¶ä¹Ÿèƒ½ç›´æ¥æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨ <code>DispatchQueue.main</code> ä½œä¸ºè°ƒåº¦ç¨‹åºæ—¶ï¼Œä¸‹è½½çš„å›¾åƒå³ä½¿åœ¨æ»šåŠ¨æ—¶ä¹Ÿä¼šç«‹å³æ˜¾ç¤ºï¼Œè€Œä½¿ç”¨ <code>RunLoop.main</code> æ—¶å›¾åƒä»…åœ¨æ»šåŠ¨åæ˜¾ç¤ºã€‚æ¢å¥è¯è¯´ï¼šåªè¦å‘ç”Ÿç”¨æˆ·äº¤äº’ï¼Œä¸»è¿è¡Œå¾ªç¯ä¸Šè®¡åˆ’çš„é—­åŒ…çš„æ‰§è¡Œå°±ä¼šè¢«å»¶è¿Ÿæ‰§è¡Œã€‚</p>
</blockquote>
<h2 id="å¦è§"><a class="markdownIt-Anchor" href="#å¦è§"></a> å¦è§</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/combine">Combine</a></li>
<li><a target="_blank" rel="noopener" href="https://www.kodeco.com/books/combine-asynchronous-programming-with-swift/v1.0/">Combine: Asynchronous Programming with Swift</a></li>
<li><a target="_blank" rel="noopener" href="https://www.avanderlee.com/combine/runloop-main-vs-dispatchqueue-main/">RunLoop.main vs DispatchQueue.main: The differences explained</a></li>
</ul>
</div><div class="tags"><a href="/tags/Combine"><i class="fa fa-tag">Combine</i></a></div><div class="post-nav"><a class="pre" href="/docker/">Docker å¤‡å¿˜æ¸…å•</a><a class="next" href="/git/">Git å¤‡å¿˜æ¸…å•</a></div><link rel="stylesheet" type="text/css" href="https://unpkg.com/disqusjs@1.3/dist/disqusjs.css"><script type="text/javascript" src="https://unpkg.com/disqusjs@1.3/dist/disqus.js"></script><script type="text/javascript" id="disqus-count-script">$(function() {
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '//disqus.com/next/config.json', true);
  xhr.timeout = 2500;
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 && xhr.status === 200) {
      $('.post-meta .post-comments-count').show();
      var s = document.createElement('script');
      s.id = 'dsq-count-scr';
      s.src = 'https://kiligwyu.disqus.com/count.js';
      s.async = true;
      (document.head || document.body).appendChild(s);
    }
  };
  xhr.ontimeout = function () { xhr.abort(); };
  xhr.send(null);
});</script><div class="comments" id="disqus_thread"><script type="text/javascript">// Load comments with DisqusJS
function loadComments() {
  window.dsqjs = new DisqusJS({
    shortname: 'kiligwyu',
    siteName: 'ğ•¶ğ–ğ–‘ğ–ğ–Œ\'ğ–˜ ğ•­ğ–‘ğ–”ğ–Œ',
    identifier: 'combine/',
    url: 'http://kiligwyu.com/combine/',
    title: 'Combine å¤‡å¿˜æ¸…å•',
    api: '',
    apikey: '',
    admin: 'kiligwyu',
    adminLabel: ''
  });
}
// Lazy load {# Credit: https://github.com/theme-next/hexo-theme-next/blob/master/layout/_third-party/comments/disqus.swig #}
(function () {
  var offsetTop = document.getElementById('disqus_thread').offsetTop - window.innerHeight;
  if (offsetTop <= 0) {
    // Load directly when there's no scrollbar
    window.addEventListener('load', loadComments, false);
  } else {
    var disqusScroll = function () {
      // offsetTop may changes because of manually resizing browser window or lazy loading images
      var offsetTop = document.getElementById('disqus_thread').offsetTop - window.innerHeight;
      var scrollTop = window.scrollY;

      // Pre-load comments a bit? (margin or anything else)
      if (offsetTop - scrollTop < 60) {
        window.removeEventListener('scroll', disqusScroll);
        loadComments();
      }
    };
    window.addEventListener('scroll', disqusScroll);
  }
})();
// Scroll to comments automatically if #comment-xxx anchor specified
window.addEventListener('load', function () {
  // I don't know why, it just works.
  window.setTimeout(function () {
    if (location.hash.indexOf('#comment-') !== -1) {
      document.getElementById('disqus_thread').scrollIntoView(true);
    }
  }, 100);
}, false);
</script></div></div></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer">Copyright Â© 2025 <a href="/." rel="nofollow">ğ•¶ğ–ğ–‘ğ–ğ–Œ'ğ–˜ ğ•­ğ–‘ğ–”ğ–Œ.</a><br> è±« ICP å¤‡ 404 å· - 1
<br> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>